DROP VIEW VW_GCQIS_INT96_DES;

CREATE VIEW [dbo].[VW_GCQIS_INT96_DES] AS
SELECT
      INC.INCIDENTID,
      INC.[GCCT_CALLERAUTHORIZATIONCODE],
      INC.CREATEDON, 
      INC.MODIFIEDON,
    VEH.[GCCT_MILEAGE]
    ,case when VEH.[GCCT_MILEAGEUNITS] = 'false' then '0'
		  when VEH.[GCCT_MILEAGEUNITS] = 'true' then '1'
	else VEH.[GCCT_MILEAGEUNITS] end as [GCCT_MILEAGEUNITS] 

,COALESCE(NULL,ACC1.GCCT_SOURCESYSTEMID, CONT.GCCT_SOURCESYSTEMID) as CONSUMERID    
,COALESCE(NULL,CNTY1.GCCT_COUNTRYCODE,CNTY.GCCT_COUNTRYCODE)as COUNTRY_CODE        
,CNTY1.GCCT_COUNTRYCODE as DEALERCOUNTRYCODE 
,CLASSIF1.gcct_fullpath_english AS  CLASSIFULLPATH1
,CLASSIF2.gcct_fullpath_english AS  CLASSIFULLPATH2
,case when SYMPTOM1.gcct_symptomcode is not null then SYMPTOM1.gcct_symptomcode ELSE REPLICATE('0', 1)  END AS  SYMPTOMCODE1    
,case when SYMPTOM2.gcct_symptomcode  is not null then SYMPTOM2.gcct_symptomcode ELSE REPLICATE('0', 2)  END AS  SYMPTOMCODE2
,case when SYMPTOM3.gcct_symptomcode   is not null then SYMPTOM3.gcct_symptomcode ELSE REPLICATE('0', 1)  END AS  SYMPTOMCODE3
,case when SYMPTOM4.gcct_symptomcode   is not null then SYMPTOM4.gcct_symptomcode ELSE REPLICATE('0', 2)  END AS  SYMPTOMCODE4
,case when SYMPTOM1.gcct_isfullsymptomclassification = 'true' or SYMPTOM1.gcct_isfullsymptomclassification = '1' 
         or SYMPTOM2.gcct_isfullsymptomclassification = 'true' or SYMPTOM2.gcct_isfullsymptomclassification = '1' 
         or SYMPTOM3.gcct_isfullsymptomclassification = 'true' or SYMPTOM3.gcct_isfullsymptomclassification = '1' 
         or SYMPTOM4.gcct_isfullsymptomclassification = 'true' or SYMPTOM4.gcct_isfullsymptomclassification = '1' 
         then 'true'
         else 'false'
         end as  ISFULLSYMPTOMPATH
,ACC.GCCT_PACODE as GCCT_PACODE
,VEH.GCCT_NAME AS [GCCT_VEHICLEIDNAME]
FROM   dbo.INCIDENT INC  WITH (NOLOCK)
INNER JOIN DBO.TEAM TEAM ON INC.OWNINGTEAM = TEAM.TEAMID
INNER JOIN DBO.BUSINESSUNIT BU ON TEAM.BUSINESSUNITID = BU.BUSINESSUNITID
LEFT JOIN DBO.GCCT_SYMPTOMCLASSIFICATION SYMPTOM1 ON INC.GCCT_SYMPTOMCLASSIFICATIONLEVEL1=SYMPTOM1.gcct_symptomclassificationId
LEFT JOIN DBO.GCCT_SYMPTOMCLASSIFICATION SYMPTOM2 ON INC.GCCT_SYMPTOMCLASSIFICATIONLEVEL2=SYMPTOM2.gcct_symptomclassificationId
LEFT JOIN DBO.GCCT_SYMPTOMCLASSIFICATION SYMPTOM3 ON INC.GCCT_SYMPTOMCLASSIFICATIONLEVEL3=SYMPTOM3.gcct_symptomclassificationId
LEFT JOIN DBO.GCCT_SYMPTOMCLASSIFICATION SYMPTOM4 ON INC.GCCT_SYMPTOMCLASSIFICATIONLEVEL4=SYMPTOM4.gcct_symptomclassificationId
LEFT JOIN CONTACT CONT WITH (NOLOCK) ON CONT.CONTACTID = INC.CUSTOMERID 
LEFT JOIN ACCOUNT ACC1 WITH (NOLOCK) ON ACC1.ACCOUNTID = INC.CUSTOMERID
LEFT JOIN GCCT_COUNTRY AS CNTY WITH (NOLOCK) ON CONT.GCCT_COUNTRYID = CNTY.Id
LEFT JOIN GCCT_COUNTRY AS CNTY1 WITH (NOLOCK) ON ACC1.[gcct_country] = CNTY1.Id 
LEFT JOIN DBO.GCCT_CASECLASSIFICATION CLASSIF1 ON INC.GCCT_CASECLASSIFICATIONLEVEL1=CLASSIF1.GCCT_CASECLASSIFICATIONID
LEFT JOIN DBO.GCCT_CASECLASSIFICATION CLASSIF2 ON INC.GCCT_CASECLASSIFICATIONLEVEL2=CLASSIF2.GCCT_CASECLASSIFICATIONID
LEFT JOIN DBO.GCCT_CASECLASSIFICATION CLASSIF3 ON INC.GCCT_CASECLASSIFICATIONLEVEL3=CLASSIF3.GCCT_CASECLASSIFICATIONID
LEFT JOIN DBO.GCCT_CASECLASSIFICATION CLASSIF4 ON INC.GCCT_CASECLASSIFICATIONLEVEL4=CLASSIF4.GCCT_CASECLASSIFICATIONID
INNER JOIN DBO.GCCT_VEHICLE VEH ON INC.GCCT_VEHICLEID=VEH.GCCT_VEHICLEID
LEFT JOIN DBO.ACCOUNT ACC WITH (NOLOCK) ON ACC.ACCOUNTID = INC.GCCT_DEALERID
WHERE INC.STATECODE = '0' AND BU.NAME IN ('Ford','Restricted Program')
AND ACC.GCCT_PACODE is not null  AND  (CONT.GCCT_SOURCESYSTEMNAME='SCA-C' OR ACC.GCCT_SOURCESYSTEMNAME='SCA-C')
